# $Id: Makefile.in,v 1.2 2003/11/13 16:08:44 simonet Exp $

###########################################################################
# Configuration

# Objective Caml bytecode compiler
OCAMLC=@OCAMLC@
OCAMLOPT=@OCAMLOPT@
OCAMLDEP=@OCAMLDEP@
OCAMLYACC=@OCAMLYACC@
OCAMLLEX=@OCAMLLEX@

# Installation directory
INSTALLDIR=@INSTALLDIR@

GENERATED= config_parse.mli config_parse.ml config_lex.ml config_builtin.ml

MKCONFIG.CU=skip model config config_parse config_lex mkconfig
MKCONFIG.CMO=$(MKCONFIG.CU:%=%.cmo)
CU=info skip model config config_parse config_lex config_builtin main
CMO=$(CU:%=%.cmo)



###########################################################################
# Main rules

default:
	$(MAKE) all
	@echo
	@echo ------------------------------------------------------------
	@echo Compilation seems to succeed
	@echo You can install the software.  As a superuser, do
	@echo \'make install\'
	@echo ------------------------------------------------------------

all: headache

clean:
	rm -f $(GENERATED)
	rm -f *.cm* headache *.output mkconfig
	rm -f Makefile config.cache config.log config.status

install: headache
	cp -f headache $(INSTALLDIR)

bootstrap: headache
	./headache -h example *.ml* Makefile

depend: $(GENERATED)
	$(OCAMLDEP) *.ml *.mli > Depend

headache: $(CMO)
	ocamlc -o $@ unix.cma str.cma $^

mkconfig: $(MKCONFIG.CMO)
	ocamlc -o $@ unix.cma str.cma $^

config_builtin.ml: config_builtin mkconfig
	./mkconfig



#########################################################################
# Generic compilation rules

.SUFFIXES: .ml .mli .mll .mly .cma .cmi .cmo .cmx .cmxa

.mli.cmi:
		$(OCAMLC) $(OCAMLC_FLAGS) -c $<
.ml.cmo:
		$(OCAMLC) $(OCAMLC_FLAGS) -c $<
.ml.cmx:	
		$(OCAMLOPT) $(OCAMLOPT_FLAGS) -c $<

.mll.ml:
		$(OCAMLLEX) $<
.mly.mli:	
		$(OCAMLYACC) -v $<
.mly.ml:	
		$(OCAMLYACC) -v $<


-include Depend
